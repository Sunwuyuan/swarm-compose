http:
  routers:
    # 154.37.221.120_17151 -> 10.163.231.1:35740
    route-154-37-221-120-17151:
      rule: "Host(`154.37.221.120`)"
      entryPoints:
        - web
        - websecure
      service: svc-154-37-221-120-17151
      middlewares:
        - forward-headers-154

    # coderun-1.190823.xyz -> 10.163.231.8:3033
    route-coderun-1-190823-xyz:
      rule: "Host(`coderun-1.190823.xyz`)"
      entryPoints:
        - web
        - websecure
      service: svc-coderun-1-190823-xyz
      middlewares:
        - forward-headers-default
        - hsts-header

    # cskv.wuyuan.dev -> 100.74.26.106:3475
    route-cskv-wuyuan-dev:
      rule: "Host(`cskv.wuyuan.dev`)"
      entryPoints:
        - web
        - websecure
      service: svc-cskv-wuyuan-dev
      middlewares:
        - forward-headers-default

    # koishi.wuyuan.dev -> 100.81.13.25:5140
    route-koishi-wuyuan-dev:
      rule: "Host(`koishi.wuyuan.dev`)"
      entryPoints:
        - web
        - websecure
      service: svc-koishi-wuyuan-dev
      middlewares:
        - forward-headers-default
        - hsts-header

    # monitor.wuyuan.dev -> 127.0.0.1:25774
    route-monitor-wuyuan-dev:
      rule: "Host(`monitor.wuyuan.dev`)"
      entryPoints:
        - web
        - websecure
      service: svc-monitor-wuyuan-dev
      middlewares:
        - forward-headers-default
        - hsts-header

    # scratch.190823.xyz -> 127.0.0.1:3068
    route-scratch-190823-xyz:
      rule: "Host(`scratch.190823.xyz`)"
      entryPoints:
        - web
        - websecure
      service: svc-scratch-190823-xyz
      middlewares:
        - forward-headers-websocket
        - hsts-header

    # search-1.190823.xyz -> 10.163.231.8:7700
    route-search-1-190823-xyz:
      rule: "Host(`search-1.190823.xyz`)"
      entryPoints:
        - web
        - websecure
      service: svc-search-1-190823-xyz
      middlewares:
        - forward-headers-default
        - hsts-header

    # search.wuyuan.dev -> 127.0.0.1:8087
    route-search-wuyuan-dev:
      rule: "Host(`search.wuyuan.dev`)"
      entryPoints:
        - web
        - websecure
      service: svc-search-wuyuan-dev
      middlewares:
        - forward-headers-default

    # social.wuyuan.dev -> 10.163.231.180:3000
    route-social-wuyuan-dev:
      rule: "Host(`social.wuyuan.dev`)"
      entryPoints:
        - web
        - websecure
      service: svc-social-wuyuan-dev
      middlewares:
        - forward-headers-default
        - hsts-header

    # subc -> 127.0.0.1:15051
    route-subc:
      rule: "Host(`subc`)"
      entryPoints:
        - web
        - websecure
      service: svc-subc
      middlewares:
        - forward-headers-default
        - content-replace-subc

    # vw.wuyuan.dev -> 127.0.0.1:5658
    route-vw-wuyuan-dev:
      rule: "Host(`vw.wuyuan.dev`)"
      entryPoints:
        - web
        - websecure
      service: svc-vw-wuyuan-dev
      middlewares:
        - forward-headers-default

    # zerocat-api.houlangs.com -> 127.0.0.1:3000
    route-zerocat-api-houlangs-com:
      rule: "Host(`zerocat-api.houlangs.com`)"
      entryPoints:
        - web
        - websecure
      service: svc-zerocat-api-houlangs-com
      middlewares:
        - forward-headers-websocket

  services:
    svc-154-37-221-120-17151:
      loadBalancer:
        servers:
          - url: "http://10.163.231.1:35740"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-coderun-1-190823-xyz:
      loadBalancer:
        servers:
          - url: "http://10.163.231.8:3033"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-cskv-wuyuan-dev:
      loadBalancer:
        servers:
          - url: "http://100.74.26.106:3475"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-koishi-wuyuan-dev:
      loadBalancer:
        servers:
          - url: "http://100.81.13.25:5140"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-monitor-wuyuan-dev:
      loadBalancer:
        servers:
          - url: "http://100.64.13.72:25774"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-scratch-190823-xyz:
      loadBalancer:
        servers:
          - url: "http://100.64.13.72:3068"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-search-1-190823-xyz:
      loadBalancer:
        servers:
          - url: "http://10.163.231.8:7700"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-search-wuyuan-dev:
      loadBalancer:
        servers:
          - url: "http://100.64.13.72:8087"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-social-wuyuan-dev:
      loadBalancer:
        servers:
          - url: "http://10.163.231.180:3000"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-subc:
      loadBalancer:
        servers:
          - url: "http://100.64.13.72:15051"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-vw-wuyuan-dev:
      loadBalancer:
        servers:
          - url: "http://100.64.13.72:5658"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    svc-zerocat-api-houlangs-com:
      loadBalancer:
        servers:
          - url: "http://100.64.13.72:3000"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

  middlewares:
    # 默认转发头 - 标准代理头部
    forward-headers-default:
      chain:
        middlewares:
          - add-default-headers

    # WebSocket支持的转发头
    forward-headers-websocket:
      chain:
        middlewares:
          - add-websocket-headers
          - add-hsts-header

    # 特殊转发头（154.37.221.120_17151）- Host头需要设置为目标地址
    forward-headers-154:
      chain:
        middlewares:
          - add-headers-154
          - add-hsts-header

    # HSTS安全头
    hsts-header:
      headers:
        customResponseHeaders:
          Strict-Transport-Security: "max-age=31536000"

    # 添加默认请求头
    add-default-headers:
      forwardauth:
        trustForwardHeader: true
      headers:
        customResponseHeaders:
          X-Cache: ""
          Cache-Control: "no-cache"
        accessControlAllowOriginList:
          - "*"

    # WebSocket相关头部
    add-websocket-headers:
      headers:
        customRequestHeaders:
          Connection: "upgrade"
        customResponseHeaders:
          X-Cache: ""
          Cache-Control: "no-cache"

    # 154地址特定头部
    add-headers-154:
      headers:
        customRequestHeaders:
          Host: "10.163.231.1:35740"
        customResponseHeaders:
          X-Cache: ""
          Cache-Control: "no-cache"

    # HSTS头部
    add-hsts-header:
      headers:
        customResponseHeaders:
          Strict-Transport-Security: "max-age=31536000"

    # 内容替换中间件（subc用于替换响应中的文本）
    content-replace-subc:
      replacePath:
        path: "/"
      # 注：subc的sub_filter功能在Traefik中需要使用插件实现，
      # 这里作为占位符，实际需要部署Traefik插件处理响应体替换
